import{world as b,system as f}from"@minecraft/server";var p={onUseOn(e){e.source,e.usedOnBlockPermutation}},y={beforeOnPlayerPlace(e){let{player:t}=e;if(!t)return;let a=t.getRotation().y,r=h(a);e.permutationToPlace=e.permutationToPlace.withState("hakomc:rotation",r)}};function h(e){let t=(e+360)%360;return t>=0&&t<90?0:t>=90&&t<180?1:t>=180&&t<270?2:3}f.beforeEvents.startup.subscribe(({itemComponentRegistry:e,blockComponentRegistry:t})=>{e.registerCustomComponent("hakomc:onuseon",p),t.registerCustomComponent("hakomc:rotation",y)});b.afterEvents.playerInteractWithBlock.subscribe(e=>{let t=e.player,a=e.beforeItemStack.typeId,r=a.split("_"),n=e.block.typeId.split("_"),i=e.block.location;if(!a.startsWith("hakomc:block_change_"))return;let c;switch(t.isSneaking?c="-":c="+",r[2]){case"num":let u=parseInt(r[3]);if(isNaN(u))return;if(n[1]==="cp"){let o=n[2]==="full"?16:parseInt(n[2]);if(isNaN(o))return;let s=m(o,u,c);l(n,i,t,s,2),t.onScreenDisplay.setActionBar(`${s}`)}else if(n[0]==="hakomc:gray"&&n[1]==="line"){let o=n[4]==="full"?16:parseInt(n[4]);if(isNaN(o))return;let s=m(o,u,c);l(n,i,t,s,4),t.onScreenDisplay.setActionBar(`${s}`)}break;case"rotate":if(n[0]==="hakomc:gray"&&n[2]==="slanting"){let o=n[3];switch(o){case"a":o=c==="+"?"c":"d";break;case"b":o=c==="+"?"d":"c";break;case"c":o=c==="+"?"b":"a";break;case"d":o=c==="+"?"a":"b";break}l(n,i,t,o,3)}else if(n[0]==="hakomc:gray"&&(n[2]==="thin"||n[2]==="thick")){let o=n[3];switch(o){case"a":o="b";break;case"b":o="a";break}l(n,i,t,o,3)}break;default:break}});function l(e,t,a,r,k){e[k]=r===16?"full":r.toString();let n=e.join("_");a.runCommand(`/setblock ${t.x} ${t.y} ${t.z} ${n}`)}function m(e,t,a){let r=a==="+"?e+t:e-t;return r===0?16:a==="+"?r>=17?r-16:r:r<0?r+16:r}
